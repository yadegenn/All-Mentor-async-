# All-Mentor-Async

## Шаблон для Telegram-бота поддержки

Этот проект представляет собой шаблон для создания ботов поддержки в Telegram. Когда пользователь отправляет сообщение боту, в административной супергруппе автоматически создаётся отдельная тема. Это позволяет администраторам управлять переписками и отвечать пользователям прямо из группы.

### Возможности

*   **Управление пользователями на основе тем**: Для каждого пользователя создаётся отдельная тема, что обеспечивает организованное и понятное общение.
*   **Двусторонняя синхронизация**: Сообщения без проблем передаются между пользователем и соответствующей темой в группе администраторов.
*   **Поддержка медиа**: Обрабатываются различные типы сообщений, включая текст, отредактированные сообщения, реакции, пересланные сообщения, ответы и медиа-альбомы (фото, файлы и видео).
*   **Хранение данных**: Используется SQLite для сохранения истории переписки и связей между пользователями и их темами.
*   **Генератор проектов**: Встроен скрипт для автоматического создания новых проектов ботов на основе конфигурационного файла `data.json`.

### Как запустить

Есть два основных способа использования этого проекта:

1.  **Запуск тестового бота**

    Основной скрипт для тестирования и разработки — `main_telebot.py`.

    ```bash
    python3 -m test_bot.main
    ```

2.  **Генерация проектов ботов**

    Вы можете создавать несколько готовых ботов с помощью скрипта `generate_files.py` и шаблонов из папки `templates/`. Сгенерированные проекты будут помещены в директорию `output/`.

    ```bash
    python generate_files.py
    ```

    Готовые боты будут находиться в `output/<Folder_Name>/`.

### Установка

Для установки всех необходимых зависимостей выполните команду:

```bash
pip install -r requirements.txt
```



### Настройка

Для генерации новых ботов необходимо настроить файл `data.json`. Вот пример:

```json
{
  "bots": [
    {
      "Folder_Name": "SupportBot1",       // Название папки для сгенерированного бота в /output
      "API_TOKEN": "ВАШ_ТОКЕН_БОТА",        // Токен, полученный от @BotFather
      "GROUP_CHAT_ID": -100123456789,    // ID супергруппы с включенными темами
      "IsParasite": false, // Является ли бот приложением к другому боту, то-есть бот подключается к той же бд, работает в том же чате
      "IsWeekPeriod": false, // Будет ли в боте работать функция уведомления пользователя в зависимости от дня недели
      "IsMenuShow": false, // Будет ли бот показывать меню с кнопками при /start или простенькое приветствие
      "IsScheduledMessage": false // Будет ли через определенное время приходить сообщение с указанным текстом после старта бота
    }
  ]
}
```


### Структура проекта

```text
.
├── README.md                          # Документация по запуску и генерации
├── LICENSE                            # Лицензия проекта
├── generate_files.py                  # Генератор ботов из шаблонов и data.json
├── data.json.example                  # Пример конфигурации генератора
├── .env.example                       # Пример переменных окружения
├── templates/                         # Jinja2-шаблоны для генерации кода
│   ├── template.py.j2                 # Базовый шаблон бота
└── test_bot/                          # Эталонный бот для разработки и проверки
    ├── main.py                        # Точка входа приложения
    ├── loader.py                      # Конфиг бота, env-настройки и пул подключений к БД
    ├── main.png                       # Иллюстрация/ассет проекта
    ├── currency_rate.json             # Локальные данные курсов/справочника
    ├── silent_users.txt               # Список пользователей с ограничениями
    ├── handlers/                      # Маршрутизация и обработка входящих событий
    │   ├── reaction.py                # Обработка реакций
    │   ├── group/                     # Логика для сообщений в админ-группе
    │   │   ├── commands.py            # Команды в группе
    │   │   ├── messages.py            # Обычные сообщения группы
    │   │   └── edit_message.py        # Редактирования сообщений в группе
    │   └── private/                   # Логика приватного чата с пользователем
    │       ├── commands.py            # Команды в личке
    │       ├── messages.py            # Текст/медиа из лички
    │       ├── callbacks.py           # Callback-query от inline-кнопок
    │       ├── markups.py             # Клавиатуры и разметка
    │       ├── edit_message.py        # Редактирования в личке
    │       └── admin_panel.py         # Функции админ-панели
    ├── middlewares/                   # Промежуточная обработка апдейтов
    │   ├── db.py                      # Подключение/контекст БД
    │   ├── album.py                   # Склейка медиа-альбомов
    │   ├── spam_control.py            # Антиспам-проверки
    │   ├── timeout.py                 # Ограничения по времени/частоте
    │   ├── ban.py                     # Проверки блокировок
    │   └── silent.py                  # Фильтрация сообщений из "тихих" топиков
    ├── utils/                         # Вспомогательная бизнес-логика
    │   ├── db.py                      # Утилиты доступа к БД
    │   ├── checker.py                 # Валидаторы/проверки данных
    │   ├── calc.py                    # Расчёты и обновление служебных данных
    │   ├── translator.py              # Локализация и перевод ключей
    │   ├── formats.py                 # Форматирование сообщений
    │   ├── io.py                      # Работа с вводом/выводом
    │   ├── logging.py                 # Конфигурация логирования
    │   ├── waits_func.py              # Отложенные/служебные функции ожидания
    │   ├── markup_sources.py          # Источники/конструкторы разметки
    │   ├── math_and_types.py          # Типы и матем. утилиты
    │   └── disable_ipv6.py            # Сетевой helper для окружения
    └── locales/                       # Файлы локализации Fluent
        ├── ru.ftl                     # Основные русские строки
        └── last_ru.ftl                # Дополнительный/предыдущий набор строк
```
